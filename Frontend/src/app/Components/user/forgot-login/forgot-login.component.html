<div class="forgot-container">
  <form
    class="forgot-form"
    [formGroup]="forgotPasswordForm"
    (submit)="submitForgotApplication()"
    >
    <header>
      <p (click)="toggleForm()">Go Back</p>
      <h1>Forgot Password</h1>
    </header>

    @if (forgotFormErrors) {
      <div class="form-errors">
        <span class="material-icons-round"> error </span>
        <p>{{ forgotFormErrors }}</p>
      </div>
    }

    <label for="forgot_email">Email</label>
    <mat-form-field appearance="fill">
      <input
        matInput
        type="email"
        id="forgot_email"
        formControlName="forgot_email"
        />
        @if (forgot_email?.invalid && forgot_email?.touched) {
          <mat-error
            >Invalid Email</mat-error
            >
        }
      </mat-form-field>

      <label for="forgot_otp">OTP Code</label>
      @if (step1) {
        <mat-form-field appearance="fill">
          <input
            matInput
            type="number"
            id="forgot_otp"
            formControlName="forgot_otp"
            />
          </mat-form-field>
        }

        @if (!step1) {
          <button
            type="submit"
            mat-raised-button
            [disabled]="forgotPasswordForm.invalid"
            class="get-code"
            >
            Get Code
          </button>
        }

        @if (loadingService.isLoading$ | async) {
          <div>
            <mat-spinner diameter="35" style="margin: auto"></mat-spinner>
            <p style="text-align: center; margin-top: 10px">Sending OTP Code...</p>
          </div>
        }
      </form>

      @if (step1 && !step2) {
        <button
          mat-raised-button
          [disabled]="forgotPasswordForm.invalid"
          (click)="submitOTPApplication()"
          class="submit-code"
          type="button"
          >
          Submit Code
        </button>
      }

      @if (step2) {
        <form
          [formGroup]="newPasswordForm"
          (submit)="submitNewPasswordApplication()"
          class="new-pass-form"
          >
          <label for="forgot_new_pass">New Password (8-20 characters)</label>
          <mat-form-field appearance="fill">
            <input
              matInput
              type="password"
              id="forgot_new_pass"
              formControlName="forgot_new_pass"
              />
            </mat-form-field>
            <label for="forgot_new_pass2">Confirm New Password</label>
            <mat-form-field appearance="fill">
              <input
                matInput
                type="password"
                id="forgot_new_pass2"
                formControlName="forgot_new_pass2"
                />
              </mat-form-field>
              @if (loadingService.isLoading$ | async) {
                <div>
                  <mat-spinner diameter="35" style="margin: auto"></mat-spinner>
                  <p style="text-align: center; margin-top: 10px">Changing...</p>
                </div>
              }
              <button type="submit" class="submit-new-pass">Submit New Password</button>
            </form>
          }
        </div>
