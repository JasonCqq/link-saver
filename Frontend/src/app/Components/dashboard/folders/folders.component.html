<app-main-sidebar></app-main-sidebar>
<app-main-nav
  [folderId]="this.tempId"
  (searchResults)="displayResults($event)"
  (sortByResults)="sortResults($event)"
></app-main-nav>

<main class="folders-container">
  <!-- Sharing Folder Form -->
  @if (shareWindowOpened) {
    <div class="folders-share-overlay">
      <form
        class="folders-share"
        [formGroup]="shareFolderForm"
        (submit)="shareFolder()"
      >
        <mat-icon
          fontIcon="close"
          (click)="toggleShareWindow()"
          class="folders-share-close"
        ></mat-icon>
        <h3>Share</h3>
        <section class="folders-share-url">
          This folder's URL will be located here:
          @if (tempShareUrl) {
            <p>linkstorage.net/public/{{ tempShareUrl }}</p>
          }
          @if (tempShareUrl) {
            <p style="color: #517ee1">Success!</p>
          }
        </section>

        <span>
          <p style="padding-bottom: 8px">Password Locked</p>
          <p-toggleswitch
            #passwordToggle
            formControlName="passwordToggle"
            (click)="togglePasswordInput()"
          />
        </span>

        <p-floatlabel variant="on">
          <label>Password</label>
          <input pInputText type="password" formControlName="password" />
        </p-floatlabel>

        <p-button type="submit" class="folders-share-button">Share</p-button>
        <p class="folders-share-hint">
          -Your username will be shown when sharing
        </p>
      </form>
    </div>
  }

  <div class="folders-buttons">
    @if (folderOpened) {
      <p-button class="folders-button folders-back" (click)="closeFolder()">
        < Go Back
      </p-button>
    }

    @if (folderOpened && tempShare) {
      <p-button
        class="folders-button folders-share"
        (click)="toggleShareWindow()"
      >
        Share Folder
      </p-button>
    }

    @if (folderOpened && !tempShare) {
      <p-button class="folders-button folders-share" (click)="unshareFolder()">
        <mat-icon fontIcon="share"></mat-icon>
        Unshare
      </p-button>
    }
  </div>

  <!--Folders Tab-->
  @if (!folderOpened) {
    <section class="folders-grid">
      <div class="folders-item" (click)="toggleWindow()">
        <i class="pi pi-plus" style="font-size: 0.8rem"></i>
        <p>Create Folder</p>
      </div>
      @if (loadingService.isLoading$ | async) {
        <p-progress-spinner
          strokeWidth="5"
          fill="transparent"
          animationDuration=".75s"
          [style]="{ width: '35px', height: '35px' }"
        />
      }
      <!--Create Folder Form-->
      @if (windowOpened) {
        <div class="folders-create-overlay">
          <form
            class="folders-create"
            [formGroup]="createFolderForm"
            (submit)="createFolder()"
          >
            <mat-icon
              fontIcon="close"
              (click)="toggleWindow()"
              class="folders-create-close"
            ></mat-icon>
            <h3>Create a Folder</h3>

            <p-floatlabel variant="on">
              <label for="folderName">Folder Name</label>
              <input
                pInputText
                type="text"
                #folderName
                formControlName="folderName"
                required
              />
            </p-floatlabel>

            <p-button type="submit" class="folders-create-button"
              >Create</p-button
            >
          </form>
        </div>
      }
      <!--Edit Folder Form-->
      @if (editWindowOpened) {
        <div class="folders-create-overlay">
          <form
            class="folders-create"
            [formGroup]="createFolderForm"
            (submit)="editFolder()"
          >
            <mat-icon
              fontIcon="close"
              (click)="toggleEditWindow('none')"
              class="folders-create-close"
            ></mat-icon>
            <h3>Edit</h3>

            <p-floatlabel variant="on">
              <label for="editFolderName">Folder Name</label>
              <input
                pInputText
                type="text"
                #editFolderName
                formControlName="editFolderName"
              />
            </p-floatlabel>

            <p-button type="submit" class="folders-create-button"
              >Edit</p-button
            >
          </form>
        </div>
      }
      @for (folder of folders; track folder) {
        <div
          class="folders-item"
          (click)="openFolder(folder.id)"
          pTooltip="{{ folder.name }} has {{ folder.links.length }} links"
        >
          <div class="folders-item-flex">
            <mat-icon fontIcon="folder"></mat-icon>
            <p>
              {{ folder.name | slice: 0 : 10
              }}{{ folder.name.length > 10 ? "..." : "" }}
            </p>
          </div>
          <div class="folders-item-options">
            <i
              class="pi pi-pencil"
              (click)="$event.stopPropagation(); toggleEditWindow(folder.id)"
              pTooltip="Edit Folder"
            ></i>

            <i
              class="pi pi-trash"
              pTooltip="Delete Folder"
              (click)="$event.stopPropagation(); deleteFolder(folder.id)"
            ></i>
          </div>
        </div>
      }
    </section>
  }

  <!--Links Tab-->
  @if (folderOpened && tempLinks) {
    <section
      [ngClass]="
        previews === true ? 'content-grid' : 'content-grid-no-previews'
      "
    >
      @for (link of tempLinks; track link) {
        <div>
          <app-link-item
            [itemData]="link"
            (linkUpdate)="deleteLink($event)"
          ></app-link-item>
        </div>
      }
    </section>
  }
</main>
