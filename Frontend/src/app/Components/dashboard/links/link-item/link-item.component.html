<div
  class="link-item"
  [ngClass]="addingID && massEditting ? 'link-item-border' : ''"
  (click)="addMassID(itemData.id)"
  pTooltip="{{ itemData.title }}"
  tooltipPosition="top"
  (mouseenter)="onMouseEnter()"
  (mouseleave)="onMouseLeave()"
  (touchstart)="toggleLinkOptions($event)"
>
  <a
    [ngClass]="massEditting ? 'disabled' : 'link-item-wrapper'"
    [href]="'//' + itemData.url"
    target="_blank"
    (click)="visitedLink()"
    (auxclick)="visitedLink()"
  >
    @if (this.previews) {
      <div class="link-preview">
        @if (itemData.pURL) {
          <img src="{{ itemData.pURL }}" alt="Refresh to view" />
        }
        @if (!itemData.pURL) {
          <p style="text-align: center; border: 1px solid gray">
            No image found
          </p>
        }
      </div>
    }

    <div
      target="_blank"
      [ngClass]="previews ? 'link-details' : 'link-details-no-previews'"
    >
      <p class="link-title">{{ itemData.title }}</p>
      <p class="link-url">{{ itemData.url }}</p>
      <p class="link-date">
        {{ itemData.createdAt | date: "shortDate" }}
      </p>

      <p class="link-visits">{{ itemData.visits }} visits</p>
    </div>
  </a>

  <!--Link CRUD Options-->
  @if (isOptionsVisible) {
    <div class="link-options">
      @if (specialRequest !== "Trash") {
        <i
          class="pi pi-times link-delete"
          (click)="moveToTrash()"
          pTooltip="Move to trash"
        ></i>
      }
      @if (specialRequest !== "Trash") {
        <i
          class="pi pi-pen-to-square link-edit"
          (click)="editForm = true"
          pTooltip="Edit Link"
        ></i>
      }
      @if (specialRequest === "Trash") {
        <i
          class="pi pi-history link-restore"
          (click)="restoreLink()"
          pTooltip="Restore Link"
        ></i>
      }
      @if (specialRequest === "Trash") {
        <i
          class="pi pi-times link-delete"
          (click)="permanentDelete()"
          pTooltip="Remove Permanently"
        ></i>
      }
    </div>

    <div class="link-options-left">
      <i
        class="pi pi-globe"
        (click)="setShowWebView()"
        pTooltip="Open web view"
      ></i>
      <i class="pi pi-eye" (click)="setShowEmbed()" pTooltip="Open embed"></i>
      <i
        class="pi pi-search-plus"
        (click)="expand = !expand"
        pTooltip="Expand preview"
      ></i>
    </div>
  }
</div>

<!-- Edit Form -->
@if (editForm) {
  <app-link-edit-form
    [itemData]="itemData"
    [(visible)]="editForm"
  ></app-link-edit-form>
}


@if (expand) {
  <div class="expanded-img" cdkDrag>
    <span cdkDragHandle>
      <i class="pi pi-circle-fill" (click)="expand = !expand"></i>
    </span>

    <img src="{{ itemData.pURL }}" alt="Refresh to view" />
  </div>
}
